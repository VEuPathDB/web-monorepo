[GENERAL]
description   = CryptoDB Protein Sequence Browser
db_adaptor    = DAS::GUS
db_args       = sub {
                 use ApiCommonWebsite::Model::ModelConfig;
                 use ApiCommonWebsite::Model::DbUtils;
                 my $c = new ApiCommonWebsite::Model::ModelConfig('CryptoDB');
                 my $resolvedDsn = ApiCommonWebsite::Model::DbUtils->resolveOracleDSN($c->appDb->dbiDsn);
                   { -sqlfile => $ENV{DOCUMENT_ROOT}.'/../conf/gbrowse.conf/cryptodbaa.xml',
                     -dsn     => $resolvedDsn,
                     -user    => $c->appDb->login,
                     -pass    => $c->appDb->password,
                   }
                }
                
#plugins = AttributeHiliter 
plugins = Aligner FastaDumper GFFDumper BatchDumper

# 'region' or 'contig' would be other typical choices,
reference class  = protein

# Web site configuration info
stylesheet  = /gbrowse/gbrowse.css
buttons     = /gbrowse/images/buttons
js          = /gbrowse/js
tmpimages   = /gbrowse/tmp
# using full url for tmpimages breaks under mod_perl.  Bio::Graphics::Browser 
# calls lookup_uri() on it.
#tmpimages   = http://cryptodb.org/gbrowse/tmp /var/www/cryptodb.org/html/gbrowse/tmp

# 24hrs/day * 360 days
image cachetime   = 8760

# Default glyph settings
glyph       = generic
height      = 8
bgcolor     = cyan
fgcolor     = cyan
label density = 25
bump density  = 2000

show sources = 0
default varying = 1 # tracks appear as defined below, not in alphabetical order

# where to link to when user clicks in detailed view
link        = /$CGI_OR_MOD/gbrowse/cryptodbaa

# what image widths to offer
image widths  = 640 800 1024 1280

# default width of detailed view (pixels)
default width = 800
default features = PfamDomains SignalP TMHMM HydropathyPlot SecondaryStructure LowComplexity BLASTP

# max and default segment sizes for detailed view
max segment     = 1000000
default segment = 500

# zoom levels
zoom levels    = 100 200 1000 2000 5000 10000

# colors of the overview, detailed map and key
overview bgcolor = lavenderblush
detailed bgcolor = thistle
key bgcolor      = mistyrose

# examples to show in the introduction
examples = EAK90506.1
           cgd6_690
           cgd7_1860
           Kinase
           "Transmembrane Protein"

# "automatic" classes to try when an unqualified identifier is given
automatic classes = protein

language = en

#empty_tracks = dashed

# a footer
footer = <hr>

# Various places where you can insert your own HTML -- see configuration docs
html1 = 
html2 = 
html3 = 
html4 = 
html5 = 
html6 = <script language="JavaScript" type="text/javascript" src="/gbrowse/wz_tooltip.js"></script>

init_code = @main::rainbow = qw(red green yellow blue khaki pink orange cyan purple);
            use vars qw($CGI_OR_MOD $CFG);
            #$CGI_OR_MOD =  'cgi-bin';
            $CGI_OR_MOD =  'mod-perl';
            use GBrowse::Configuration;
            $CFG = new GBrowse::Configuration;
            sub hover {
              use HTML::Template;
	      my ($name, $data) = @_;
          my $tmpl = HTML::Template->new(filename => $ENV{DOCUMENT_ROOT}.'/gbrowse/hover.tmpl');
	      $tmpl->param(DATA => [ map { { @$_ > 1 ? (KEY => $_->[0], VALUE => $_->[1]) : (SINGLE => $_->[0]) } } @$data ]);
	      my $str = $tmpl->output;
	      $str =~ s/'/\\'/g;
	      $str =~ s/\"/&quot;/g;
	      $str =~ s/\s+$//;
	      my $cmd = "this.T_STICKY=false;this.T_TITLE='$name'";
	      $cmd = qq{" onMouseOver="$cmd;return escape('$str')};
	      return $cmd;
	    }

### TRACK CONFIGURATION ####
# the remainder of the sections configure individual tracks

###################################
# Plugin configuration
###################################
[WastlingMassSpecPeptides]
feature      = domain:WastlingMassSpecPeptides
filter = sub { $CFG->filter_to_depth( @_, 'WastlingMassSpecPeptides', 5) }
glyph        = segments
font2color   = black
fgcolor =  white
bgcolor      = sub { my $f = shift;
                     $f = $f->parent if (! $f->get_tag_values('ExtDbName'));
                     my ($extdbname) = $f->get_tag_values('ExtDbName');
                     ($extdbname =~ m/1d/i) && return 'mediumslateblue';
                     ($extdbname =~ m/mudpit soluble/i) && return 'black';
                     ($extdbname =~ m/mudpit insoluble/i) && return 'brown';
                     ($extdbname =~ m/2d/i) && return 'green';
                     return 'yellow';
                   }
height       = 5
pad_bottom   = -1 
description  = 0 
link	=  javascript:void(0)
title  = sub {}
#bump density = 200
#link_target density = 100; # custom attribute
link_target  = sub { $CFG->link_target_ms_peptides( @_ ) }
label 		 = 0
key       = MS/MS Peptides (Wastling, et al.)
citation  = <b>Preliminary</b> analysis by J.M.
             Wastling, S. Sanderson, D. Xia and A.Z. Siddiki. 
             Departments of Pre-Clinical Veterinary Science & Veterinary Pathology, University of Liverpool, 
             Crown Street, Liverpool, United Kingdom L69 7ZJ<br><b>A significantly more comprehensive analysis is forthcoming</b>.

[LoweryMassSpecPeptides]
feature      = domain:LoweryMassSpecPeptides
filter = sub { $CFG->filter_to_depth( @_, 'WastlingMassSpecPeptides', 5) }
glyph        = segments
font2color   = black
fgcolor =  white
bgcolor      = sub { my $f = shift;
                     $f = $f->parent if (! $f->get_tag_values('ExtDbName'));
                     my ($extdbname) = $f->get_tag_values('ExtDbName');
                     ($extdbname =~ m/Insoluble Excysted/i) && return 'maroon';
                     ($extdbname =~ m/Insoluble Non-excysted/i) && return 'darksalmon';
                     ($extdbname =~ m/Soluble Excysted and Non-excysted/i) && return 'lightseagreen';
                     return 'yellow';
                   }
height       = 5
pad_bottom   = -1 
description  = 0 
link	=  javascript:void(0)
title  = sub {}
#bump density = 200
#link_target density = 100; # custom attribute
link_target  = sub { $CFG->link_target_ms_peptides( @_ ) }
label 		 = 0
key       = MS/MS Peptides (Snelling, et al.)
citation  =  Analysis by William J. Snelling<sup>1</sup>, Qishan Lin<sup>2</sup>, John E. Moore<sup>3</sup>, B. Cherie Millar<sup>3</sup>,
             Fabio Tosini<sup>4</sup>, Edoardo Pozio<sup>4</sup>, James S.G. Dooley<sup>1</sup>, and Colm J. Lowery<sup>1</sup><br>
             <sup>1</sup>Centre for Molecular Biosciences, School of Biomedical Sciences,
             University of Ulster, Cromore Road, Coleraine, County Londonderry, N.
             Ireland, BT52 1SA.
             <sup>2</sup>UAlbany Proteomics Facility, Centre for Functional Genomics, University of
             Albany, One Discovery Drive, Rensselaer, NY 12144.
             <sup>3</sup>Northern Ireland Public Health Laboratory, Department of Bacteriology,
             Belfast City Hospital, Belfast, N. Ireland, BT9 7AD.
             <sup>4</sup>Department of Infectious, Parasitic, and Immunomediated Diseases, Istituto
             Superiore di Sanit&#224;, Rome, Italy.<br>
             <a href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&db=pubmed&dopt=Abstract&list_uids=17124246">
   		    Proteomics analysis and protein expression during sporozoite excystation of Cryptosporidium parvum (Coccidia, Apicomplexa).
		    Mol. Cell Proteomics 2007 Feb;6(2):346-55
		    </a>


[EinsteinMassSpecPeptides]
feature      = domain:EinsteinMassSpecPeptides
filter = sub { $CFG->filter_to_depth( @_, 'WastlingMassSpecPeptides', 5) }
glyph        = segments
font2color   = black
fgcolor =  white
bgcolor      = sub { my $f = shift;
                     return 'yellow';
                   }
height       = 5
pad_bottom   = -1 
description  = 0 
link	=  javascript:void(0)
title  = sub {}
#bump density = 200
#link_target density = 100; # custom attribute
link_target  = sub { $CFG->link_target_ms_peptides( @_ ) }
label 		 = 0
key       = MS/MS Peptides (Einstein, et al.)

[FerrariMassSpecPeptides]
feature      = domain:FerrariMassSpecPeptides
filter = sub { $CFG->filter_to_depth( @_, 'FerrariMassSpecPeptides', 5) }
glyph        = segments
font2color   = black
fgcolor =  white
bgcolor      = sub { my $f = shift;
                     return 'yellow';
                   }
height       = 5
pad_bottom   = -1 
description  = 0 
link	=  javascript:void(0)
title  = sub {}
#bump density = 200
#link_target density = 100; # custom attribute
link_target  = sub { $CFG->link_target_ms_peptides( @_ ) }
label 		 = 0
key       = MS/MS Peptides (Ferrari)

[InterproDomains]
feature      = domain:interpro
glyph        = segments
font2color   = black
bgcolor      = sub { my $f = shift;
                     $main::seenPfam{$f->feature_id} ||= $main::rainbow[scalar(keys %main::seenPfam) % scalar(@main::rainbow)]; 
                     return $main::seenPfam{$f->feature_id}; 
                   } 
height       = 8 
#link_target        = sub { my $f = shift; 
#                     my $name = $f->name; 
#                     my ($desc) = $f->get_tag_values("Note"); 
#                     my @data; 
#                     push @data, [ 'Name:'  => $name ]; 
#                     push @data, [ 'Description:' => $desc ]; 
#                     hover("Pfam Domain: $name", \@data); 
#                   } 
description  = 0 
label        = 1 
link         = sub { my $f = shift;
                     my ($db) = $f->get_tag_values('Db');
										 my ($pi) = $f->get_tag_values('Pi');
										 my $url;
										 if($db eq 'INTERPRO') { 
										   $url = qq|http://www.ebi.ac.uk/interpro/DisplayIproEntry?ac=$pi|;
										 } elsif( $db eq 'PFAM') { 
										   $url = qq|http://pfam.sanger.ac.uk/family?acc=$pi|;
										 } elsif( $db eq 'PRINTS') {
										   $url = qq|http://umber.sbs.man.ac.uk/cgi-bin/dbbrowser/sprint/searchprintss.cgi?prints_accn=$pi&display_opts=Prints&category=None&queryform=false&regexpr=off|;
										 } elsif( $db eq 'PRODOM') {
										   $url = qq|http://prodom.prabi.fr/prodom/current/cgi-bin/request.pl?question=DBEN&query=$pi|;
										 } elsif( $db eq 'PROFILE') {
                       $url = qq|http://www.expasy.org/prosite/$pi|;
										 } elsif( $db eq 'SMART') {
                       $url = qq|http://smart.embl-heidelberg.de/smart/do_annotation.pl?ACC=$pi&BLAST=DUMMY|; 
										} elsif( $db eq 'SUPERFAMILY') { 
										   $url = qq|http://supfam.org/SUPERFAMILY/cgi-bin/scop.cgi?ipid=$pi|;
										} else {
										   $url = qq|http://www.ebi.ac.uk/interpro/ISearch?query=$pi&mode=all|;
										}
										return $url;
									}
key          = Interpro Domains 
citation     = Interpro: PFam, PIR, Prints, Prodom, Smart, Superfamily, TIGRFAM, Prosite

[SignalP]
feature      = domain:SignalP
glyph        = segments
font2color   = black
bgcolor      = dodgerblue
height       = 10
link_target  = sub { my $f = shift;
		 my @data;
                 my ($d_score) = $f->get_tag_values("DScore");
                 my ($signal_prob) = $f->get_tag_values("SignalProb");
                 my ($conclusion_score) = $f->get_tag_values("ConclusionScore");
                 push @data, [ 'Coordinates:' => $f->start . ' .. ' . $f->end ];
                 push @data, [ 'NN Conclusion Score:' => $conclusion_score ];
                 push @data, [ 'NN D-Score:' => $d_score ];
                 push @data, [ 'HMM Signal Probability:' => $signal_prob ];
		 hover("Signal peptide", \@data);
	       }
label        = 0
link         = ""
description  = 0
key          = Signal Peptide
citation     = Signal peptide predictions by SP-HMM/SP-NN

[TMHMM]
feature      = domain:TMHMM
glyph        = segments
font2color   = black
bgcolor      = lightsteelblue
height       = 10 
link_target        = sub { my $f = shift;
		             my $name = $f->name;
		             my ($desc) = $f->get_tag_values("Topology");
		             my @data;
		             push @data, [ 'Name:'  => $name ];
		             push @data, [ 'Topology:' => $desc ];
		             hover("Transmembrane Domain", \@data);
	               }
label        = 0
link         = ""
description  = 0
key          = Transmembrane Domains
citation     = Transmembrane domains detected by TmHMM

[HydropathyPlot]
glyph        = protein
global feature = 1
height       = 40
do_kd        = 1
fgcolor      = red
axis_color   = blue
link         = 0
citation     = Kyte-Doolittle hydropathy plot

[SecondaryStructure]
glyph        = secondary_structure
global feature = 1
height       = 40
pad_top      = 16
heading      = Secondary Structure
do_plots     = 1
fgcolor      = red
axis_color   = purple
helix_color  = red
coil_color   = white
strand_color = blue
citation     = PSIPRED secondary structure prediction

[BLASTP]
feature      = match:BLASTP
glyph        = graded_segments
font2color   = black
bgcolor      = red
height       = 8
stranded     = 1
link_target        = sub { my $f = shift;
		             my $name = $f->name;
		             my ($desc) = $f->get_tag_values("Note");
					 my ($idnt) = $f->get_tag_values("PercentIdentity"); 
					 my ($evalue) = $f->get_tag_values("Expect");
					 my ($pos) = $f->get_tag_values("PercentPositive");
		             my @data;
		             push @data, [ 'Name:'        => $name ];
		             push @data, [ 'Description:' => $desc ];
		             push @data, [ 'Expectation:' => $evalue ];
		             push @data, [ '% Identity:' => $idnt ];
		             push @data, [ '% Positive:'  => $pos ];
		             hover("WU_BLASTP: $name", \@data);
	       }
description  = 1
label        = 0
link         = http://ncbi.nlm.nih.gov/entrez/viewer.fcgi?db=protein&val=$name
key          = BLASTP Hits
citation     = BLASTP Hits

[LowComplexity]
feature      = lowcomplexity:seg
glyph        = segments
bgcolor      = grey
height       = 6
title        = sub {
                 my $f = shift;
		 my @data;
                 my ($sequence) = $f->get_tag_values("Sequence");
                 push @data, [ 'Coordinates:' => $f->start . '..' . $f->end ];
		 push @data, [ 'Sequence:'  => $sequence ];
		 hover("Low complexity", \@data);
	       }
description  = 0
label        = 0
link         = ""
key          = Low Complexity Regions
citation     = Regions of low sequence complexity, as defined by the
               <code>seg</code> algorithm
