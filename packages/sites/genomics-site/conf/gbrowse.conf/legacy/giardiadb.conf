[GENERAL]
description   = GiardiaDB
db_adaptor    = DAS::GUS
db_args       = sub {
                 use ApiCommonWebsite::Model::ModelConfig;
                 use ApiCommonWebsite::Model::DbUtils;
                 my $c = new ApiCommonWebsite::Model::ModelConfig('GiardiaDB');
                 my $resolvedDsn = ApiCommonWebsite::Model::DbUtils->resolveOracleDSN($c->appDb->dbiDsn);
                 { -sqlfile => $ENV{DOCUMENT_ROOT}.'/../conf/gbrowse.conf/giardiadb.xml',
                   -dsn     => $resolvedDsn,
                     -user    => $c->appDb->login,
                     -pass    => $c->appDb->password,
                   }
                 }

search_instructions =

#plugins = AttributeHiliter 
plugins = BatchDumper FastaDumper GFFDumper RestrictionAnnotator

# 'region' or 'contig' would be other typical choices,
# remember that in chado, the ref class must be part of 
# SOFA (as must all feature types)
# reference class  = chromosome
# Note: reference class is very importment !!!
reference class  = contig

# for better display of comparative genome data
#postgrid    = 1
background  = 1
grid        = 0

# Web site configuration info
stylesheet  = /include/gbrowse.css
buttons     = /images/gbrowse/buttons

tmpimages   = /gbrowse/tmp
# using full url breaks under mod_perl.  Bio::Graphics::Browser calls lookup_uri()
# on it.
#tmpimages   = http://giardiadb.org/gbrowse/tmp /var/www/giardiadb.org/html/gbrowse/tmp 

# Default glyph settings
glyph       = generic
height      = 8
bgcolor     = cyan
fgcolor     = cyan
label density = 250
bump density  = 2000

show sources = 0
default varying = 1 # tracks appear as defined below, not in alphabetical order

# where to link to when user clicks in detailed view
link        =

# what image widths to offer
image widths  = 640 800 1024 1280
# default width of detailed view (pixels)
default width = 800 
default features = Gene 

# max and default segment sizes for detailed view
max segment     = 2000000
default segment = 50000

# zoom levels
zoom levels    = 100 200 1000 2000 5000 10000 20000 30000 40000 60000 100000 200000 500000 1000000 2000000

# colors of the overview, detailed map and key
overview bgcolor = lightgrey
detailed bgcolor = lightgoldenrodyellow
key bgcolor      = beige

# examples to show in the introduction
examples = CH991767:227600..229950
           AACB02000007:225400..227800
           GL50803_102438
           "Transmembrane Protein"

# "automatic" classes to try when an unqualified identifier is given
automatic classes = gene

language = en

#empty_tracks = suppress
upload_tracks section = on

### HTML TO INSERT AT VARIOUS STRATEGIC LOCATIONS ###
# inside the <head></head> section
head = <script type='text/javascript' src='/giardiadb/js/newwindow.js'></script>
       <link rel="stylesheet" href="/giardiadb/misc/style.css" type="text/css">
       <style type="text/css">
         BODY { margin-left:10px; margin-right:10px; margin-top:5px}
       </style> 

# at the top...
header = sub { 
          my $header .= qq(<table><tr><td width=30%><a href='/'><img src="/giardiadb/images/Mancuso1green2_blackbg_rotated_scale100.gif" border='0'></a></td>);
          $header .= qq(<td align=center width=40%><b><font face="Arial,Helvetica" size=+3>Genome Browser</font></b></td>\n);
          $header .= qq(<td width=30%>&nbsp;</td></tr></table>);
          $header .= qq(<tr><td colspan=3><!--#include virtual='/include/toolbar.html' --></td></tr></table>);
		      return $header;
         }
footer = sub { return qq(<hr><!--#include virtual='/include/footer.html' -->); }

# Various places where you can insert your own HTML -- see configuration docs
html1 = 
html2 = 
html3 = 
html4 = 
html5 = 
html6 = <script language="JavaScript" type="text/javascript" src="/gbrowse/wz_tooltip.js"></script>

init_code = use vars qw($CGI_OR_MOD);
            #$CGI_OR_MOD = 'cgi-bin';
            $CGI_OR_MOD  = 'mod-perl';
            # group writable tmp files
            umask 0002; 
            sub hover { 
              use HTML::Template; 
			        my ($name, $data) = @_; 
			        my $tmpl = HTML::Template->new(filename => $ENV{DOCUMENT_ROOT}.'/gbrowse/hover.tmpl'); 
			        $tmpl->param(DATA => [ map { { Key => $_->[0], Value => $_->[1], } } @$data ]); 
						  my $str = $tmpl->output; 
						  $str =~ s/'/\\'/g; 
                          $str =~ s/\"/&quot;/g;
						  $str =~ s/\s+$//; 
              $str =~ s/\\n//; 
						  my $cmd = "this.T_STICKY=true;this.T_TITLE='$name'"; 
						  #return "$cmd;return escape('$str')"; 
              $cmd = qq{" onmouseover="$cmd;return escape('$str') };
			     }

#aggregators = 

#postgrid     = sub { use DAS::Util::SynView;
#                     return DAS::Util::SynView::postgrid(@_); }

### TRACK CONFIGURATION ####
# the remainder of the sections configure individual tracks

###################################
# Plugin configuration
###################################



[Contigs]
feature	   = contig:Genbank
glyph	   = arrow
fgcolor      	= sub {
                   my $f = shift;
		   my ($orient) = $f->get_tag_values("Orientation");
		   if ($orient eq "0") {
			return "yellow";
		   } else {
			return "darkseagreen";
		   }
		}
bgcolor = fgcolor
height	     = 12
description  = 1
ruler	     = 1
tick	     = 1
link	     = sub { my $f = shift; 
                       my $name = $f->name; 
                       return "/giardiadb/showRecord.do?name=SequenceRecordClasses.SequenceRecordClass&primary_key=$name&project_id=GiardiaDB"
                }
link_target  = sub { 
                 my $f = shift;
		 my $name = $f->name;
                 my $start = $f->start; 
                 my $end = $f->end; 
		 my $chr = $f->seq_id;
		 my $loc = $f->location->to_FTstring;
		 my ($orient) = $f->get_tag_values("Orientation");
		 my ($length) = $f->get_tag_values("Length");
		 #my $start     = $f->start;
		 my $stop      = $f->stop;
                 my @data;
		 push @data, [ 'Name:'  => $name ];
                 push @data, [ 'Start:'       => $start ];
                 push @data, [ 'Stop:'        => $stop ];
                 push @data, [ 'Orientation:' => $orient ];
                 hover( "Contig $name", \@data);
		}
label 	   = 1
relative_coords = 1
direction       = strand
linewidth	= 4
tickwidth	= 1
key		= Contigs
citation        = 


[Gene]
feature      = gene:Genbank 
glyph        = processed_transcript
bgcolor		   = sub { my $f = shift;
					         my $strand = $f->strand;
									 $f->strand > 0 ? "blue" : "red";
					     }
#fgcolor		   = sub { my $f = shift;
#					         my $strand = $f->strand;
#									 $f->strand > 0 ? "blue" : "darkred";
#					     }
font2color   = black
height       = 10 
description  = 1 
bump density = 100
label density= 100
link	       = sub { my $f = shift; 
			           my $name = $f->name; 
				         return "/giardiadb/showRecord.do?name=GeneRecordClasses.GeneRecordClass&project_id=GiardiaDB&primary_key=$name";
			          }
link_target  = sub { my $f = shift;
			           my $name = $f->name; 
			           my $start = $f->start; 
			           my $end = $f->end; 
                 my $length = $end - $start + 1;
			           my $gi = $f->get_tag_values('Dbxref'); 
                 my ($desc) = $f->get_tag_values('Note');
                 my ($type) = $f->get_tag_values('Type');
                 my $cds = qq(<a href=/cgi-bin/geneSrt?project_id=GiardiaDB&ids=$name&type=CDS&upstreamAnchor=Start&upstreamOffset=0&downstreamAnchor=End&downstreamOffset=0&go=Get+Sequences>CDS</a>);
                 my $protein = qq(<a href=/cgi-bin/geneSrt?project_id=GiardiaDB&ids=$name&type=protein&upstreamAnchor=Start&upstreamOffset=0&downstreamAnchor=End&downstreamOffset=0&go=Get+Sequences>Protein</a>);
			           my @data; 
			           push @data, [ 'Locus:' => $name ]; 
			           push @data, [ 'Type:' => $type ]; 
			           push @data, [ 'Location:' => "$start - $end" ]; 
                 push @data, [ 'Length:' => $length ];
                 push @data, [ 'Function:' => $desc ];
			           push @data, [ 'Download:' => $cds. ' | '. $protein . ' in a new window.'];
                 '' . hover( "Annotated Gene $name", \@data);
			        }
label 		   = 1
preset       = Annotation
key          = Annotated Genes
citation     = Annotated gene track shows protein coding gene, rRNA and tRNA genes.  Blue color indicates that gene is forward strand. Red color indicates that gene is reverse strand.

[DeprecatedGene]
feature      = deprecatedgene:Genbank 
glyph        = processed_transcript
bgcolor		   = sub { my $f = shift;
					         my $strand = $f->strand;
									 $f->strand > 0 ? "lightblue" : "pink";
					     }
font2color   = black
height       = 10 
description  = 1 
bump density = 100
label density= 100
link	       = sub { my $f = shift; 
			           my $name = $f->name; 
				         return "/giardiadb/showRecord.do?name=GeneRecordClasses.GeneRecordClass&project_id=GiardiaDB&primary_key=$name";
			          }
link_target  = sub { my $f = shift;
			           my $name = $f->name; 
			           my $start = $f->start; 
			           my $end = $f->end; 
                 my $length = $end - $start + 1;
			           my $gi = $f->get_tag_values('Dbxref'); 
                 my ($desc) = $f->get_tag_values('Note');
                 my ($type) = $f->get_tag_values('Type');
                 my $cds = qq(<a href=/cgi-bin/geneSrt?project_id=GiardiaDB&ids=$name&type=CDS&upstreamAnchor=Start&upstreamOffset=0&downstreamAnchor=End&downstreamOffset=0&go=Get+Sequences>CDS</a>);
                 my $protein = qq(<a href=/cgi-bin/geneSrt?project_id=GiardiaDB&ids=$name&type=protein&upstreamAnchor=Start&upstreamOffset=0&downstreamAnchor=End&downstreamOffset=0&go=Get+Sequences>Protein</a>);
			           my @data; 
			           push @data, [ 'Locus:' => $name ]; 
			           push @data, [ 'Type:' => $type ]; 
			           push @data, [ 'Location:' => "$start - $end" ]; 
                 push @data, [ 'Length:' => $length ];
                 push @data, [ 'Function:' => $desc ];
			           push @data, [ 'Download:' => $cds. ' | '. $protein . ' in a new window.'];
                 '' . hover( "Deprecated Gene $name", \@data);
			        }
label 		   = 1
preset       = Annotation
key          = Deprecated Genes
citation     = The deprecated gene track shows protein coding gene, rRNA and tRNA genes that were overlapping with better annotated genes and have since been marked as deprecated.  Blue color indicates that gene is forward strand. Red color indicates that gene is reverse strand.

[RatnerMassSpecPeptides]
feature      = domain:RatnerMassSpecPeptides
glyph        = segments
font2color   = black
fgcolor =  white
bgcolor      = sub { my $f = shift;
                     $f = $f->parent if (! $f->get_tag_values('ExtDbName'));
                     my ($extdbname) = $f->get_tag_values('ExtDbName');
                     ($extdbname =~ m/1d/i) && return 'mediumslateblue';
                     ($extdbname =~ m/mudpit soluble/i) && return 'black';
                     ($extdbname =~ m/mudpit insoluble/i) && return 'blue';
                     ($extdbname =~ m/2d/i) && return 'green';
                     return 'brown';
                   }
height       = 10
pad_bottom   = -1 
description  = 0 
link	=  javascript:void(0)
title  = sub {}
#bump density = 200
#link_target density = 100; # custom attribute
link_target  = sub {  my $f = shift;
                      my ($desc) = $f->get_tag_values('Description');
                      $desc =~ s/[\r\n]/<br>/g;
		      my ($seq) =  $f->get_tag_values('Sequence');
                      my @data;
                      push @data, [ '' => "sequence:$seq<br>$desc" ];
                      hover('', \@data);
                   }

label 		 = 0
key       = MS/MS Peptides (Ratner, et al.)
citation  = <b>Preliminary</b> analysis by Daniel Ratner, et al. 
             Department of Bioengineering, University of Washington, 
             William H. Foege Building, Box 355061, Seattle, WA 98195-5061<br>

[BLASTX]
feature      = match:WU_BLASTX
glyph        = graded_segments
height       = 6 
label		     = 0
stranded     = 1
bump density = 400
link         = http://www.ncbi.nlm.nih.gov/entrez/viewer.fcgi?db=protein&val=$name
link_target 		 = sub {
				 	my $f = shift; 
					my $name = $f->name; 
					my ($desc) = $f->get_tag_values("description");
					my ($evalue) = $f->get_tag_values('Expect');
					my $score = $f->score; 
					my ($tstart) = $f->get_tag_values('TStart');
					my ($tstop )= $f->get_tag_values('TStop');
					my $link = qq(<a href=http://www.ncbi.nlm.nih.gov/entrez/viewer.fcgi?db=protein&val=$name>$name</a>); 
					my @data; 
					push @data, [ 'Name:' => $name ]; 
					push @data, [ 'E-value:' => $evalue ]; 
					push @data, [ 'Score:' => $score ]; 
					push @data, [ 'Location:' => "$tstart - $tstop"]; 
					push @data, [ 'Function:' => $desc ]; 
					hover( "$name", \@data); 
				}
bgcolor		 = sub { 
					my $f = shift; 
					my $strand = $f->strand; 
					if($strand eq '+1') { 
						return 'navy'; 
					} else { 
						return 'maroon';
				    }
				}
category  = Alignment
key          = GenBank Non-Redundant Protein (NRDB)
citation     = Giardia lamblia contig sequences vs NRDB:  <br /> BLASTX blastx version: BLASTX 2.0MP-WashU. <br /><br /> Parameters used: matrix=BLOSUM62 V=100 B=1000000 -hspmax=1000000 W=4 T=18 -gi E=1e-3 -wordmask=seg -hspsepQmax=50000 -span1 -topcomboN=1. <br /><br /> In house scripts where used to post-process the results by E-value, match length and overlap for display top 5 matches in GBrowse.

[ORF]
feature      = alignment:ORF
glyph        = cds
height       = 12
key          = ORF > 50aa
stranded     = 1
bgcolor      = sub {
                 my ($f, undef, undef, undef, $glyph) = @_;
                 my $flip = $glyph->{flip};
                 $f->strand == ($flip ? -1 : 1) ? "navy" : "maroon";
               }
fgcolor      = black
description  = 0
label       = 0
bump_limit  = 10
link 	     =  sub { my $f = shift;
                    my $name = $f->name;
										my $link = "/giardiadb/showRecord.do?name=OrfRecordClasses.OrfRecordClass&project_id=GiardiaDB&primary_key=$name";
										return $link;
									}
link_target        = sub {
                 my $f = shift;
                 my $name = $f->name;
                 my $start  = $f->start; 
                 my $stop   = $f->stop; 
                 my @data; 
                 push @data, [ 'Name:'   => $name ]; 
                 push @data, [ 'Start:'  => $start ]; 
                 push @data, [ 'Stop:'   => $stop ]; 
                 push @data, [ 'Length:' => abs($stop - $start) . ' nt' ]; 
                 return hover( 'ORFs >= 50 nt', \@data); 
               } 
citation     = ORFs greater than 150nt, generated by GiardiaDB. 

[DoTSAssemblies]
feature      = alignment:DoTSAssemblies
category  = Alignment
glyph        = segments
bgcolor      = sub {
                        my ($f, undef, undef, undef, $glyph) = @_;
                        my $flip = $glyph->{flip};
                        $f->strand == ($flip ? -1 : 1) ? "navy" : "maroon";
                }
description  = 0
height       = 8
title        = sub { my $f = shift;
                 my $name  = $f->name; 
	     	 my $start = $f->start;
	     	 my $stop  = $f->stop;
                 my @data; 
		 my ($percent_identity) = $f->get_tag_values("PercentIdentity");
		 my ($count) = $f->get_tag_values("Count");
                 push @data, [ 'Name:' => $name ]; 
             	 push @data, [ 'Start:'  => $start ];
             	 push @data, [ 'Stop:'   => $stop ];
                 push @data, [ 'Percent Identity:' => $percent_identity ]; 
                 push @data, [ 'Count of ESTs:' => $count ]; 
		 hover("DoTS EST Assemblies: $name", \@data);
               }
link 	     = sub { my $f = shift;
                     my $name = $f->name;
                     my $link = "/giardiadb/showRecord.do?name=AssemblyRecordClasses.AssemblyRecordClass&project_id=GiardiaDB&primary_key=$name";
                     return $link;
               }
#das category = similarity
glyph        = graded_segments
strand_arrow = 0
bump_limit   = 50
key          = DoTS EST Assemblies
citation     = This track shows BLAT alignment of DTs to the genome (W.J.Kent (2002) BLAT-The BLAST-Like Alignment Tool, Genome Research 12:656-664). DTs are consensus transcript sequences generated by clustering ESTs based on BLAT alignment to the genome followed by CAP4 assembly ( Huang, X. and Madan, A. (1999) CAP3: A DNA Sequence Assembly Program. Genome Research, 9: 868-877).


[EST]
feature     = alignment:BLAT
glyph       = segments
bgcolor		  = lightskyblue
fgcolor		  = blue
description = 0
height      = 8
label       = 0
link 	      = sub { my $f = shift;
					     my $name = $f->name;
					     return "/giardiadb/showRecord.do?name=EstRecordClasses.EstRecordClass&project_id=GiardiaDB&primary_key=$name";
			        }
link_target  = sub {
                 my $f     = shift;
                 my $name  = $f->name;
                 my $start = $f->start; 
                 my $stop  = $f->stop; 
                 my $score = $f->score; 
                 my ($pct) = $f->get_tag_values('PCT'); 
                 my @data; 
                 push @data, [ 'Name:'   => $name ]; 
                 push @data, [ 'Location:' => "$start..$stop " . abs($stop-$start) . ' nt' ]; 
                 push @data, [ 'Score:' => $score ];
                 push @data, [ 'Percent Identity:' => $pct ];
                 return hover( "EST $name", \@data); 
               } 
category   = Alignment
preset     = Annotation
key 		   = EST Alignments - Top 10

[ESTAll]
feature     = alignment:EST
glyph       = segments
bgcolor		  = lightskyblue
fgcolor		  = blue
description = 0
height      = 8
label       = 0
link 	      = sub { my $f = shift;
					     my $name = $f->name;
					     return "/giardiadb/showRecord.do?name=EstRecordClasses.EstRecordClass&project_id=GiardiaDB&primary_key=$name";
			        }
link_target  = sub {
                 my $f     = shift;
                 my $name  = $f->name;
                 my $start = $f->start; 
                 my $stop  = $f->stop; 
                 my $score = $f->score; 
                 my ($pct) = $f->get_tag_values('PCT'); 
                 my @data; 
                 push @data, [ 'Name:'   => $name ]; 
                 push @data, [ 'Location:' => "$start..$stop " . abs($stop-$start) . ' nt' ]; 
                 push @data, [ 'Score:' => $score ];
                 push @data, [ 'Percent Identity:' => $pct ];
                 return hover( "EST $name", \@data); 
               } 
category   = Alignment
preset     = Annotation
key 		   = EST Alignments

[Frames]
feature      = gene:Genbank
glyph        = cds
frame0f      = cadetblue
frame1f      = blue
frame2f      = darkblue
frame0r      = darkred
frame1r      = red
frame2r      = crimson
height       = 20
link		 = 
label 		 = 
description  = 0
key          = Frame Usage

[TranslationF]
glyph        = translation
global feature = 1
frame0       = cadetblue
frame1       = blue
frame2       = darkblue
height       = 40
fgcolor      = purple
strand       = +1
translation  = 3frame
link 	     =
key          = 3-frame translation (forward) 
citation     = It draws three frame conceptutal translations. At low magnifications (zoomed way out), this track draws littel symbols indicating where start and stop codons are. At high magnifications, the actual amino acid sequence comes into view. <br /><br /> Frame +1: cadetblue <br />Frame +2: blue <br />Frame +3: darkblue

[DNA/GC Content]
glyph		 = dna
global feature = 1
height		 = 40
do_gc        = 1
link 	     =
fgcolor		 = red
axis_color   = blue
citation     = It displays a GC content graph of the reference sequence at low magnifications and the DNA sequence itself at higher magnifications.

[TranslationR]
glyph        = translation
global feature = 1
frame0       = darkred
frame1       = red
frame2       = crimson
height       = 40
fgcolor      = blue
strand       = -1
link 	     =
translation  = 3frame
key          = 3-frame translation (reverse)
citation     = It draws three frame conceptutal translations. At low magnifications (zoomed way out), this track draws littel symbols indicating where start and stop codons are. At high magnifications, the actual amino acid sequence comes into view. <br /><br />Frame -1: darkred<br />Frame -2: red<br />Frame -3: crimson<br />


[SAGEtags]
feature      = SAGE:3-5prime
category     = SAGE
glyph        = arrow
strand_arrow = 0
linewidth    = 2
height       = 8
bgcolor      = blue
fgcolor      = blue
link 	      = sub { my $f = shift;
                      my ($sourceId)    = $f->get_tag_values('SourceID'); 
                      my $name = $sourceId;
                      return "/giardiadb/showRecord.do?name=SageTagRecordClasses.SageTagRecordClass&project_id=GiardiaDB&primary_key=$name";
                   }
link_target  = sub {
                 my $f            = shift;
                 my $name         = $f->name;
                 my $start        = $f->start; 
                 my $stop         = $f->stop; 
                 my ($sourceId)    = $f->get_tag_values('SourceID'); 
                 my ($tag)        = $f->get_tag_values('Sequence'); 
                 my ($occurrence) = $f->get_tag_values('Occurrence'); 
#                 my ($librarytotal)=$f->get_tag_values('librarytotal');
                 my @data; 
                 push @data, [ 'Name:'          => "$sourceId" ];
                 push @data, [ 'Temporary external ID:' => "$name" ];
                 push @data, [ 'Location:'      => "$start..$stop" ];
                 push @data, [ 'Sequence:'      => $tag ];
#                 push @data, [ 'Normalized Library Total:'    => "$librarytotal"];
                 push @data, [ 'Found in genome:'  => $occurrence ];
                 my $bulkEntries = $f->bulkAttributes();
                 push @data, [ "<b>Library</b>" => "<b>Percent | RawCount</b>" ];
                 foreach my $item (@$bulkEntries) {
                   my $lib = $item->{LIBRARY_NAME};
                   my $raw_count = $item->{RAW_COUNT};
                   my $percent = sprintf("%.3f", $item->{LIBRARY_TAG_PERCENTAGE});
                   push @data, [ "$lib" => "$percent % | $raw_count" ];
                }
                return hover( "Sage Tag $sourceId", \@data); 
               } 
key          = SAGE tags
label	       = 0
citation     = SAGE tag sequences are mapped to genome assembly contigs and 
  predicted open reading frames (ORFs) using custom software. 
  As SAGE tags are generated by the most 3 prime Nla III restriction site, 
  many are from the 3 prime untranslated region (UTR) of mRNA transcripts. 
  SAGE tags are thus mapped to theoretical transcripts, which are modeled as the 
  complete Open Reading Frame (ORF) plus 15 bp of 3 prime UTR. 
  This model is used for both sense and anti-sense transcripts. 
  Tag Frequencey equals to Tag count and  Percentage=(Tag count/38015)*100. 
  The total good tags sequenced is 38015.

[AnnotationDensity]
feature      = annotation:density
glyph        = xyplot
graph_type   = boxes
bump density = 1
scale        = right
#scale       = both
bgcolor      = lightslategray
fgcolor      = blue
height       = 60
min_score    = 0
label        = 0
key          = Gene Density
citation     = See <a href="#Annotation">below</a>.
