<DAS>

<sanityTestInfo project="ToxoDB">
    <defaultParamValue name="name" value="TGME49_039250"/>
    <defaultParamValue name="srcfeature_id" value="$$aa_seq_id_X$$"/>
    <defaultParamValue name="base_start" value="1"/>
    <defaultParamValue name="rend" value="9030"/>
    <defaultParamValue name="dlm" value="|"/>
    <defaultParamValue name="id" value="TGME49_039250-1"/>

    <sqlValue name="aa_seq_id_X">
      <sql>
       select aa_sequence_id from dots.translatedAaSequence where source_id like 'TGME49_039250%'
      </sql>
    </sqlValue>
    <sqlValue name="aa_seq_id_I">
      <sql>
       select aa_sequence_id from dots.translatedAaSequence where source_id like 'TGME49_024100%'
      </sql>
    </sqlValue>
</sanityTestInfo>

<sanityTestInfo project="CryptoDB">
  <defaultParamValue name="name" value="cgd7_230"/>
  <defaultParamValue name="srcfeature_id" value="$$aa_seq_id_cgd7_230$$"/>
  <defaultParamValue name="base_start" value="1"/>
  <defaultParamValue name="rend" value="880"/>
  <defaultParamValue name="dlm" value=","/>

  <sqlValue name="aa_seq_id_cgd7_230">
    <sql>
  SELECT AA_SEQUENCE_ID 
  FROM   DOTS.GENEFEATURE gf, 
         DOTS.TRANSCRIPT t, 
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'cgd7_230'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id  
    </sql> 
  </sqlValue>

  <sqlValue name="aa_seq_id_CMU_018010">
    <sql>
  SELECT AA_SEQUENCE_ID
  FROM   DOTS.GENEFEATURE gf,
         DOTS.TRANSCRIPT t,
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'CMU_018010'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id
    </sql>
  </sqlValue>

  <sqlValue name="aa_seq_id_1MB.841">
    <sql>
  SELECT AA_SEQUENCE_ID
  FROM   DOTS.GENEFEATURE gf,
         DOTS.TRANSCRIPT t,
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = '1MB.841'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id
    </sql>
  </sqlValue>

  <sqlValue name="aa_seq_id_cgd6_690">
    <sql>
  SELECT AA_SEQUENCE_ID 
  FROM   DOTS.GENEFEATURE gf, 
         DOTS.TRANSCRIPT t, 
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'cgd6_690'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id  
    </sql> 
  </sqlValue>
</sanityTestInfo>


<sanityTestInfo project="PlasmoDB">
  <defaultParamValue name="name" value="PF11_0344"/>
  <defaultParamValue name="srcfeature_id" value="$$aa_seq_id_sample_gene$$"/>
  <defaultParamValue name="base_start" value="1"/>
  <defaultParamValue name="rend" value="1868"/>
  <defaultParamValue name="dlm" value=","/>

  <sqlValue name="aa_seq_id_sample_gene">
    <sql>
  SELECT AA_SEQUENCE_ID
  FROM   DOTS.GENEFEATURE gf,
         DOTS.TRANSCRIPT t,
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'PF11_0344'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id
    </sql>
  </sqlValue>
  <sqlValue name="aa_seq_id_PKH_133200">
    <sql>
  SELECT AA_SEQUENCE_ID
  FROM   DOTS.GENEFEATURE gf,
         DOTS.TRANSCRIPT t,
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'PKH_133200'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id
    </sql>
  </sqlValue>
  <sqlValue name="aa_seq_id_PFF1545w">
    <sql>
  SELECT AA_SEQUENCE_ID
  FROM   DOTS.GENEFEATURE gf,
         DOTS.TRANSCRIPT t,
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'PFF1545w'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id
    </sql>
  </sqlValue>
  <sqlValue name="tas_id_with_transmem">
    <sql>
  select aa_sequence_id
  from dots.TransmembraneAaFeature
  where rownum = 1
    </sql>
  </sqlValue>
</sanityTestInfo>

<sanityTestInfo project="TriTrypDB">
  <defaultParamValue name="name" value="Tb927.8.620"/>
  <defaultParamValue name="srcfeature_id" value="$$aa_seq_id_sample_gene$$"/>
  <defaultParamValue name="base_start" value="1"/>
  <defaultParamValue name="rend" value="500"/>
  <defaultParamValue name="dlm" value=","/>

  <sqlValue name="aa_seq_id_sample_gene">
    <sql>
  SELECT AA_SEQUENCE_ID 
  FROM   DOTS.GENEFEATURE gf, 
         DOTS.TRANSCRIPT t, 
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'Tb927.8.620'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id  
    </sql> 
  </sqlValue>
  
  <sqlValue name="aa_seq_id_sample_L_infantum_gene">
    <sql>
  SELECT AA_SEQUENCE_ID 
  FROM   DOTS.GENEFEATURE gf, 
         DOTS.TRANSCRIPT t, 
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'LinJ17_V3.0100'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id  
    </sql> 
  </sqlValue>
  
  <sqlValue name="tas_id_with_transmem">
    <sql>
  select aa_sequence_id
  from dots.TransmembraneAaFeature
  where rownum = 1
    </sql> 
  </sqlValue>
</sanityTestInfo>

<sanityTestInfo project="GiardiaDB">
    <defaultParamValue name="srcfeature_id" value="$$aa_seq_id_GL50803_102438$$"/>
    <defaultParamValue name="base_start" value="1"/>
    <defaultParamValue name="rend" value="900"/>
    <defaultParamValue name="dlm" value=","/>
    <defaultParamValue name="name" value="GL50803_102438"/>

  <sqlValue name="aa_seq_id_GL50803_102438">
    <sql>
  SELECT AA_SEQUENCE_ID 
  FROM   DOTS.GENEFEATURE gf, 
         DOTS.TRANSCRIPT t, 
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'GL50803_102438'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id  
    </sql> 
  </sqlValue>
  <sqlValue name="aa_seq_id_GL50803_31750">
    <sql>
  SELECT AA_SEQUENCE_ID
  FROM   DOTS.GENEFEATURE gf,
         DOTS.TRANSCRIPT t,
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'GL50803_31750'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id
    </sql>
  </sqlValue>
 </sanityTestInfo>

<sanityTestInfo project="TrichDB">
    <defaultParamValue name="srcfeature_id" value="$$aa_seq_id_TVAG_386080$$"/>
    <defaultParamValue name="base_start" value="1"/>
    <defaultParamValue name="rend" value="500"/>
    <defaultParamValue name="dlm" value=","/>
    <defaultParamValue name="name" value="TVAG_386080"/>

  <sqlValue name="aa_seq_id_TVAG_386080">
    <sql>
  SELECT AA_SEQUENCE_ID
  FROM   DOTS.GENEFEATURE gf,
         DOTS.TRANSCRIPT t,
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'TVAG_386080'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id
    </sql>
  </sqlValue>
  <sqlValue name="aa_seq_id_TVAG_008710">
    <sql>
  SELECT AA_SEQUENCE_ID
  FROM   DOTS.GENEFEATURE gf,
         DOTS.TRANSCRIPT t,
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'TVAG_008710'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id
    </sql>
  </sqlValue>
  <sqlValue name="aa_seq_id_TVAG_538840">
    <sql>
  SELECT AA_SEQUENCE_ID
  FROM   DOTS.GENEFEATURE gf,
         DOTS.TRANSCRIPT t,
         DOTS.TRANSLATEDAAFEATURE taf
  WHERE gf.source_id = 'TVAG_538840'
        AND t.parent_id = gf.na_feature_id
        AND taf.na_feature_id = t.na_feature_id
    </sql>
  </sqlValue>
</sanityTestInfo>



  <module name="GUS.pm">
<!-- ORIGINALLY FROM: crypto -->
  <sqlQuery name="get_feature_by_name">
    <sql>
<![CDATA[
SELECT regexp_replace(trp.source_id, '-1$', '') ctg_name, 
       tas.aa_sequence_id feature_id, 
       tas.aa_sequence_id parent_id, 
       'protein' type, 
       'annotation' source, 
       trp.protein_id name, 
       1  startm, 
       tas.length end
FROM   dots.translatedaasequence tas,
       dots.translatedaafeature taf,
       dots.transcript trp
WHERE  tas.aa_sequence_id = taf.aa_sequence_id and
       taf.na_feature_id = trp.na_feature_id and
        ( trp.source_id = '$name' or trp.source_id like '$name-%')
]]>
    </sql>
  </sqlQuery>
  </module>

  <module name="Segment.pm">

<!-- ORIGINALLY FROM: crypto -->
  <sqlQuery name="new:Segment">
      <sql>
<![CDATA[
SELECT ga.aa_sequence_id srcfeature_id, 
       1 startm, 
       ga.protein_length end, 
       ga.source_id name, 
       'protein' type,
       'ID=' || ga.aa_sequence_id atts
FROM   ApidbTuning.GeneAttributes ga
WHERE  ga.source_id = '$name'
]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="get_sequence">
      <sql>
<![CDATA[
SELECT tas.sequence 
FROM   DoTS.TranslatedAASequence tas 
WHERE  tas.aa_sequence_id = $srcfeature_id
]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="domain:MassSpecPeptidePhospho">
      <sql>
<![CDATA[
SELECT msf.aa_feature_id feature_id,
       'domain' type,
       '$source' source,
       msf.source_id name,
       aal.start_max startm,
       aal.end_max end,
       'Description=' || msf.description || '$dlm' ||
       'Count=' || match_count || '$dlm' ||
       'ExtDbName=' || ed.name || '$dlm' ||
       'Experiment=' || mst.experiment || '$dlm' ||
       'Sample=' || mst.sample || '$dlm' ||
       'Color=' || mst.html_color || '$dlm' ||
       'PhosphoSite=' || y.phospho_site || '$dlm' ||
       'Ontology=' || y.ontology_name || '$dlm' ||
       'PhosphoScore=' || y.phospho_score || '$dlm' ||
       'PepSeq=' || substr(taas.sequence, aal.start_min, aal.end_max - aal.start_min + 1) atts
FROM  dots.massspecfeature msf,
      apidb.massspecsummary mss,
      dots.aalocation aal,
      dots.translatedaafeature taaf,
      dots.translatedaasequence taas,
      sres.externaldatabaserelease edr,
      sres.externaldatabase ed,
      apidbtuning.massspecterms mst,
      (SELECT msf.na_feature_id as feat_id,
              apidb.tab_to_string(set(CAST(COLLECT(so.term_name ||'') AS apidb.varchartab)),';') as ontology_name,
              apidb.tab_to_string(set(CAST(COLLECT(pot.description ||'') AS apidb.varchartab)),';') as phospho_score,
              apidb.tab_to_string(set(CAST(COLLECT(aal.start_min ||'') AS apidb.varchartab)),';') as phospho_site
       FROM  dots.massspecfeature msf,
             dots.aalocation aal,
             dots.posttranslationalmodfeature pot,
             dots.translatedaafeature taaf,
             sres.externaldatabaserelease edr,
             sres.SequenceOntology so,
             sres.externaldatabase ed
       WHERE pot.parent_id = msf.aa_feature_id
         AND pot.aa_feature_id = aal.aa_feature_id
         AND msf.parent_id = taaf.aa_feature_id
         AND taaf.aa_sequence_id = $srcfeature_id
         AND msf.external_database_release_id = edr.external_database_release_id
         AND edr.external_database_id = ed.external_database_id
         AND so.sequence_ontology_id = pot.sequence_ontology_id
         AND ed.name $$edName$$
       GROUP BY msf.na_feature_id) y, 
      (SELECT  count(*) as match_count, min(msf.na_feature_id) as feat_id
       FROM  dots.massspecfeature msf,
             dots.aalocation aal,
             dots.translatedaafeature taaf,
             dots.translatedaasequence taas,
             sres.externaldatabaserelease edr,
             sres.externaldatabase ed
       WHERE msf.parent_id = taaf.aa_feature_id
         AND taaf.aa_sequence_id = $srcfeature_id
         AND taaf.aa_sequence_id = taas.aa_sequence_id
         AND msf.aa_feature_id = aal.aa_feature_id
         AND msf.external_database_release_id = edr.external_database_release_id
         AND edr.external_database_id = ed.external_database_id
         AND ed.name $$edName$$
       GROUP BY ed.name,aal.start_max ,aal.end_max) x
WHERE msf.na_feature_id =  x.feat_id
      AND  mss.mass_spec_summary_id = msf.source_id
      AND  (ed.name = mst.internal_id or mst.internal_id = ed.name||'|'||mss.sample_file)
      AND msf.na_feature_id = y.feat_id(+)
      AND msf.parent_id = taaf.aa_feature_id
      AND taaf.aa_sequence_id = $srcfeature_id
      AND taaf.aa_sequence_id = taas.aa_sequence_id
      AND msf.aa_feature_id = aal.aa_feature_id
      AND msf.external_database_release_id = edr.external_database_release_id
      AND edr.external_database_id = ed.external_database_id
    ]]>
    </sql>
  </sqlQuery>

    <sqlQuery name="domain:MassSpecPeptide">
      <sql>
<![CDATA[
SELECT msf.aa_feature_id feature_id,
       'domain' type,
       '$source' source,
       msf.source_id name,
       aal.start_max startm,
       aal.end_max end,
       'Description=' || msf.description || '$dlm' ||
       'Count=' || match_count || '$dlm' ||
       'ExtDbName=' || ed.name || '$dlm' ||
       'Experiment=' || mst.experiment || '$dlm' ||
       'Sample=' || mst.sample || '$dlm' ||
       'Color=' || mst.html_color || '$dlm' ||
       'PepSeq=' || substr(taas.sequence, aal.start_min, aal.end_max - aal.start_min + 1) atts
FROM  dots.massspecfeature msf,
      apidb.massspecsummary mss,
      dots.aalocation aal,
      dots.translatedaafeature taaf,
      dots.translatedaasequence taas,
      sres.externaldatabaserelease edr,
      sres.externaldatabase ed,
      apidbtuning.massspecterms mst,
      (SELECT  count(*) as match_count, min(msf.na_feature_id) as feat_id
FROM  dots.massspecfeature msf,
      dots.aalocation aal,
      dots.translatedaafeature taaf,
      dots.translatedaasequence taas,
      sres.externaldatabaserelease edr,
      sres.externaldatabase ed
WHERE msf.parent_id = taaf.aa_feature_id
      AND taaf.aa_sequence_id = $srcfeature_id
      AND taaf.aa_sequence_id = taas.aa_sequence_id
      AND msf.aa_feature_id = aal.aa_feature_id
      AND msf.external_database_release_id = edr.external_database_release_id
      AND edr.external_database_id = ed.external_database_id
      AND ed.name $$edName$$
      group by ed.name,aal.start_max ,aal.end_max) x
WHERE msf.na_feature_id =  x.feat_id
      AND mss.mass_spec_summary_id = msf.source_id
      AND  (ed.name = mst.internal_id or mst.internal_id = ed.name||'|'||mss.sample_file)
      AND msf.parent_id = taaf.aa_feature_id
      AND taaf.aa_sequence_id = $srcfeature_id
      AND taaf.aa_sequence_id = taas.aa_sequence_id
      AND msf.aa_feature_id = aal.aa_feature_id
      AND msf.external_database_release_id = edr.external_database_release_id
      AND edr.external_database_id = ed.external_database_id
    ]]>
    </sql>
  </sqlQuery>


 <sqlQuery name="lowcomplexity:seg">
    <testParamValues project="CryptoDB">
       <param name="srcfeature_id" value="$$aa_seq_id_CMU_018010$$"/>
       <param name="base_start" value="13500"/>
       <param name="rend" value="13564"/>
    </testParamValues>
    <testParamValues project="TrichDB">
       <param name="srcfeature_id" value="$$aa_seq_id_TVAG_538840$$"/>
       <param name="base_start" value="1"/>
       <param name="rend" value="12"/>
    </testParamValues>
      <sql>
<![CDATA[ 
SELECT lc.aa_feature_id feature_id,
       'lowcomplexity' type, 
       'seg' source, 
       'low complexity region' name, 
       '.' score, 
       lc.aa_sequence_id parent_id, 
       aal.start_min startm, 
       aal.end_max end, 
       '.' strand,
       'Sequence=' || substr(aas.sequence, aal.start_min, (aal.end_max-aal.start_min+1)) atts
FROM   dots.LowComplexityAAFeature lc,
       dots.AALocation aal, dots.AASequence aas
WHERE  lc.aa_feature_id = aal.aa_feature_id and
       lc.aa_sequence_id = aas.aa_sequence_id and
       aal.start_min <= $rend and 
       aal.end_max >= $base_start and 
       lc.aa_sequence_id = $srcfeature_id 
ORDER BY aal.start_min
]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="get_2d_struc">
    <testParamValues project="ToxoDB">
       <param name="srcfeature_id" value="$$aa_seq_id_I$$"/>
    </testParamValues>
    <testParamValues project="PlasmoDB">
       <param name="srcfeature_id" value="$$aa_seq_id_PKH_133200$$"/>
    </testParamValues>
       <sql>
<![CDATA[
SELECT ssc.structure_type, ssc.call_confidence 
FROM   DoTS.SecondaryStructure ss,
       DoTS.SecondaryStructureCall ssc
WHERE  ss.aa_sequence_id = $srcfeature_id and
       ss.secondary_structure_id = ssc.secondary_structure_id
]]>
      </sql>
    </sqlQuery>

<!-- Was only in: plasmo -->
    <sqlQuery name="domain:ExportPred" includeProjects="PlasmoDB">
    <testParamValues project="PlasmoDB">
       <param name="srcfeature_id" value="$$aa_seq_id_PFF1545w$$"/> 
    </testParamValues>
      <sql>
<![CDATA[
SELECT DISTINCT df.aa_feature_id feature_id,
       'domain' type,
       'ExportPred' source,
       df.aa_feature_id name,
       '.' score,
       df.parent_id parent_id,
       min(aal.start_min) startm,
       max(aal.end_max) end,
       '.' strand,
       'ID=' || df.aa_feature_id atts
FROM   dots.domainfeature df,
       dots.aasequence aas,
       dots.aalocation aal
WHERE  df.algorithm_name = 'exportpred' and
       df.aa_sequence_id = $srcfeature_id and
       aas.aa_sequence_id = $srcfeature_id and
       df.aa_feature_id = aal.aa_feature_id
GROUP BY df.aa_feature_id, df.parent_id
]]>
      </sql>
    </sqlQuery>

<!-- ORIGINALLY FROM: plasmo,toxo,tritryp -->
  <sqlQuery name="domain:SignalP">
    <testParamValues project="CryptoDB">
       <param name="srcfeature_id" value="$$aa_seq_id_1MB.841$$"/> 
    </testParamValues>
    <testParamValues project="GiardiaDB">
       <param name="srcfeature_id" value="$$aa_seq_id_GL50803_31750$$"/>
    </testParamValues> 
    <testParamValues project="TrichDB">
       <param name="srcfeature_id" value="$$aa_seq_id_TVAG_008710$$"/>
    </testParamValues>
     <sql>
<![CDATA[
SELECT
       spf.aa_feature_id feature_id,
       'domain' type,
       'SignalP' source,
       spf.aa_feature_id name,
       '.' score,
       spf.parent_id parent_id,
       1 startm,
       aal.end_max end,
       '.' strand,
       'DScore=' || ((spf.means_score + spf.maxy_score) / 2) || '$dlm' ||
       'SignalProb=' || spf.signal_probability || '$dlm' ||
       'Algorithm=' || spf.algorithm_name || '$dlm' ||
       'ConclusionScore=' || (spf.maxy_conclusion +
               spf.maxc_conclusion +
               spf.maxs_conclusion +
               spf.means_conclusion) as  atts
FROM
       dots.signalpeptidefeature spf,
       dots.aalocation aal
WHERE
       spf.aa_sequence_id = $srcfeature_id and
       aal.aa_feature_id = spf.aa_feature_id and
       (( spf.maxy_conclusion +
         spf.maxc_conclusion +
         spf.maxs_conclusion +
         spf.means_conclusion
       ) >= 3
       OR ((spf.means_score + spf.maxy_score) / 2) >= 0.5
       OR spf.signal_probability >= 0.5
      ) 
]]>
      </sql>
    </sqlQuery>



<!-- ORIGINALLY FROM: giardia,trich,tritryp -->
    <sqlQuery name="domain:TMHMM">
    <testParamValues project="TriTrypDB">
    <param name="srcfeature_id" value="$$tas_id_with_transmem$$"/>
    </testParamValues>
    <testParamValues project="PlasmoDB">
    <param name="srcfeature_id" value="$$aa_seq_id_sample_gene$$"/>
    </testParamValues>
    <testParamValues project="CryptoDB">
       <param name="srcfeature_id" value="$$aa_seq_id_cgd6_690$$"/>
    </testParamValues>
    <testParamValues project="TrichDB">
       <param name="srcfeature_id" value="$$aa_seq_id_TVAG_008710$$"/>
    </testParamValues>
    <sql>
<![CDATA[
SELECT
       tmf.aa_feature_id feature_id,
       'domain' type,
       'TMHMM' source,
       tmf.aa_feature_id name,
       '.' score,
       tmf.parent_id parent_id,
       aal.start_min startm,
       aal.end_max end,
       '.' strand,
       'Topology=' || tmf.topology atts
FROM
       dots.transmembraneaafeature tmf,
       dots.translatedaasequence tas,
       dots.aalocation aal
WHERE
       tas.aa_sequence_id = $srcfeature_id and
       tmf.aa_sequence_id = $srcfeature_id and
       tmf.aa_feature_id = aal.aa_feature_id
]]>
      </sql>
    </sqlQuery>

  <sqlQuery name="domain:interpro">
      <sql>
<![CDATA[
SELECT df.aa_feature_id feature_id, 
       'domain' type, 
       'interpro' source, 
       dr.primary_identifier name, 
       df.score score, 
       df.parent_id parent_id, 
       al.start_min startm, 
       al.end_max end, 
       'Note=' || dr.secondary_identifier || ' ' || dr.remark || '$dlm' || 
       'Db=' || xd1.name || '$dlm' || 
       'InterproId=' || df2.source_id || '$dlm' || 
       'Evalue=' || df.e_value || '$dlm' || 
       'Pi=' || dr.primary_identifier atts
             from
             dots.aalocation al,
             sres.externaldatabaserelease xdr1,
             sres.externaldatabase xd1,
             sres.externaldatabaserelease xdr3,
             sres.externaldatabase xd3,
             sres.dbref dr,
             dots.DbRefAAFeature draf,
             dots.domainfeature df,
             dots.genefeature gf,
             dots.transcript t,
             dots.translatedaafeature taf,
             dots.translatedaasequence tas,
             dots.domainfeature df2
             where  df.aa_sequence_id = $srcfeature_id 
             and al.end_max > $base_start
             and al.start_min < $rend 
             and xd3.name in ('INTERPRO','InterproscanData_RSRC')
             and gf.na_feature_id = t.parent_id
             and t.na_feature_id = taf.na_feature_id
             and taf.aa_sequence_id = tas.aa_sequence_id
             and tas.aa_sequence_id = df.aa_sequence_id
             and df.aa_feature_id = draf.aa_feature_id
             and df.aa_feature_id = al.aa_feature_id
             and draf.db_ref_id = dr.db_ref_id
             and dr.external_database_release_id = xdr1.external_database_release_id
             and xdr1.external_database_id = xd1.external_database_id
             and df.external_database_release_id = xdr3.external_database_release_id
             and xdr3.external_database_id = xd3.external_database_id
             and df.parent_id = df2.aa_feature_id (+)
      ]]> 
      </sql>
  </sqlQuery>

    <sqlQuery name="match:BLASTP">
      <sql>
<![CDATA[ 
SELECT * FROM 
(SELECT sim.similarity_id feature_id,
       'match' type, 
       'BLASTP' source, 
       eta.source_id name, 
       sim.score score, 
       sim.query_id  parent_id, 
       sim.min_query_start startm, 
       sim.max_query_end   end, 
       '.' strand,
       'Note=' || eta.description || '$dlm' ||
       'Expect=' || sim.pvalue_mant || 'e' || sim.pvalue_exp || '$dlm' ||
       'PercentIdentity=' || round(100 * sim.number_identical / sim.total_match_length) || '$dlm' ||
       'PercentPositive=' || round(100 * sim.number_positive / sim.total_match_length) atts
FROM   dots.similarity sim,
       dots.externalaasequence eta,
       dots.translatedaasequence tas, 
       core.tableinfo qtab,
       core.tableinfo stab
WHERE  sim.query_id = tas.aa_sequence_id and
       sim.subject_id = eta.aa_sequence_id and
       sim.subject_table_id = stab.table_id and
       stab.name = 'ExternalAASequence' and
       sim.query_table_id  = qtab.table_id and
       qtab.name = 'TranslatedAASequence' and
       sim.query_id = $srcfeature_id 
ORDER BY
       to_number(sim.pvalue_mant || 'e' || sim.pvalue_exp) asc,
       sim.total_match_length desc,
       sim.score desc

) WHERE RowNum < 6
]]>
      </sql>
    </sqlQuery>

  </module>

  <module name="Feature.pm">

<!-- Was only in: plasmo -->
    <sqlQuery name="domain:ExportPred:subfeatures" includeProjects="PlasmoDB">
    <testParamValues project="PlasmoDB">
      <param name="parent_id" parentFeatureTest="domain:ExportPred"/>       
    </testParamValues>
      <sql>
<![CDATA[ 
SELECT aal.aa_location_id feature_id,
       'subdomain' type,
       'ExportPred' source,
       aal.aa_location_id name,
       aal.aa_feature_id parent_id,
       '' phase,
       '.' score,
       '.' strand,
       aal.start_min startm,
       aal.end_max end,
       'ID=' || aal.aa_location_id atts
FROM   dots.aalocation aal
WHERE  aal.aa_feature_id = $parent_id
ORDER BY aal.start_min
]]>
      </sql>
    </sqlQuery>


<!--
    <sqlQuery name="domain:TMHMM:subfeatures">
    <testParamValues project="TriTrypDB">
    <param name="parent_id" parentFeatureTest="domain:TMHMM"/>
    </testParamValues>
      <sql>
<![CDATA[ 
SELECT
       aal.aa_location_id feature_id,
       'subdomain' type,
       'TMHMM' source,
       aal.aa_location_id name,
       aal.aa_feature_id parent_id,
       aal.start_min startm,
       aal.end_max end,
       'Topology=' || tmf.topology atts
FROM
     DoTS.transmembraneaafeature tmf,
     DoTS.aalocation aal,
     Core.algorithm alg
WHERE
       tmf.aa_feature_id = aal.aa_feature_id and
       tmf.aa_sequence_id = $parent_id and
       tmf.prediction_algorithm_id = alg.algorithm_id AND
       alg.name = 'TMHMM'
ORDER BY aal.start_min
]]>
      </sql>
    </sqlQuery>



    <sqlQuery name="domain:interpro:bulksubfeatures">
      <sql>
<![CDATA[ 
SELECT 
       aal.aa_location_id feature_id,
       'subdomain' type, 
       'interpro' source, 
       dr.primary_identifier name, 
       df.score score, 
       df.aa_feature_id parent_id, 
       aal.start_min startm, 
       aal.end_max end,
       '.' strand
FROM
       dots.DomainFeature df,
       dots.DbRefAaFeature draf,
       dots.AaLocation aal,
       sres.DbRef dr,
       sres.ExternalDatabaseRelease edr,
       sres.ExternalDatabase ed,
       core.AlgorithmInvocation ainv,
       core.AlgorithmImplementation aimp
WHERE
       df.aa_sequence_id = $srcfeature_id and
       aal.end_max > $base_start and
       aal.start_min < $rend and
       aal.aa_feature_id = df.aa_feature_id and
       df.aa_feature_id = draf.aa_feature_id and
       draf.db_ref_id = dr.db_ref_id and
       dr.external_database_release_id = edr.external_database_release_id and
       edr.external_database_id = ed.external_database_id and
       df.row_alg_invocation_id = ainv.algorithm_invocation_id and
       ainv.algorithm_implementation_id = aimp.algorithm_implementation_id and
       aimp.executable = 'ApiCommonData::Load::Plugin::InsertInterproscanResults'
]]>
      </sql>
    </sqlQuery>

-->

    <sqlQuery name="match:BLASTP:subfeatures">
    <testParamValues project="TriTrypDB">
       <param name="parent_id" parentFeatureTest="match:BLASTP"/> 
    </testParamValues>
    <testParamValues project="ToxoDB">
       <param name="parent_id" parentFeatureTest="match:BLASTP"/>
    </testParamValues>
    <testParamValues project="CryptoDB">
       <param name="parent_id" parentFeatureTest="match:BLASTP"/>
    </testParamValues>
    <testParamValues project="PlasmoDB">
       <param name="parent_id" value="106486"/>
    </testParamValues>
    <testParamValues project="GiardiaDB">
       <param name="parent_id" parentFeatureTest="match:BLASTP"/>
    </testParamValues>
    <testParamValues project="TrichDB">
       <param name="parent_id" parentFeatureTest="match:BLASTP"/>
    </testParamValues>
      <sql>
<![CDATA[ 
SELECT simp.similarity_span_id feature_id, 
       'HSP' type, 
       'BLASTP' source, 
       simp.similarity_span_id name, 
       '.' phase, 
       simp.score || '' score, 
       simp.query_start startm, 
       simp.query_end end, 
       decode (simp.is_reversed, 0, '+1', 1, '-1', '.') strand, 
       '' atts 
FROM   dots.similarity sim, dots.similarityspan simp 
WHERE  sim.similarity_id = simp.similarity_id and 
       sim.similarity_id  = $parent_id
]]>
       </sql>
    </sqlQuery>   

  </module>

</DAS>

