// FIXME: Come to a consensus on the font weights we'd like to provide for Roboto
@import url('https://fonts.googleapis.com/css?family=Roboto:400,500,600,700&display=swap');
@import 'ebrc-client/styles/themes.scss';

// Header breakpoints
$cramped-header-width: 1100px;
$hamburger-width: 960px;

// Search Pane + Main + News breakpoints
$tablet-width: 1000px;
$mobile-width: 900px;
$small-mobile-width: 415px;

$expanded-header-height: 11em;
$collapsed-header-height: 5.5em;

$branding-height: 7em;
$small-branding-scale-factor: 0.57142857142em;


/**** VEUPATH SITES ***/
// eupath  bkgrnd
@include themify($child: '') {
  $primary-color: themed('primary-color');
  $bckgrnd-img: themed('bckgrnd-img');
  $logo: themed('logo');
  $small-logo: themed('small-logo');
  /* TODO Remove when we're out of beta */
  $beta-position-top: themed('beta-position-top');
  $beta-position-left: themed('beta-position-left');
  $beta-font-size: themed('beta-font-size');
  $beta-position-top-small: themed('beta-position-top-small');
  $beta-position-left-small: themed('beta-position-left-small');
  $beta-font-size-small: themed('beta-font-size-small');

  .vpdb-BgDark {
    background-color: $primary-color;
  }

  .vpdb-BdDark {
    border-color: $primary-color; 
  }

  .vpdb-Header {
    background-image: $bckgrnd-img;
    background-size: cover;
    background-position: center;

    .ebrc-HeaderBrandingContainer {
      a {
        position: relative;
      }

      a::after {
        content: "(beta)";
        position: absolute;
        @if ($beta-position-top) {
          top: $beta-position-top;
        } @else {
          top: 1.2em;
        }
        left: $beta-position-left;
        @if ($beta-font-size) {
          font-size: $beta-font-size;
        } @else {
          font-size: 1.4em;
        }
        font-weight: 500;
        color: white;
      }
    }

    .ebrc-HeaderBranding {
      content: $logo;
      height: $branding-height;
    }

    &__collapsed {
      .ebrc-HeaderBrandingContainer {
        font-size: $small-branding-scale-factor;

        a::after {
          top: $beta-position-top-small;
          left: $beta-position-left-small;
          font-size: $beta-font-size-small;
        }
      }

      .ebrc-HeaderBranding {
        content: $small-logo;
      }
    }
    
    @media screen and (max-width: $cramped-header-width) {
      .ebrc-HeaderBrandingContainer {
        font-size: $small-branding-scale-factor;

        a::after {
          top: $beta-position-top-small;
          left: $beta-position-left-small;
          font-size: $beta-font-size-small;
        }
      }

      .ebrc-HeaderBranding {
        content: $small-logo;
      }
    }
  }

  .vpdb-SearchPane {
    .wdk-CheckboxTree {
      > .wdk-CheckboxTreeList {
        border-bottom: 0.0625rem solid $primary-color;

        @media screen and (max-width: $mobile-width) {
          border-bottom: none;
        }
      }
    }
  }

  .vpdb-Main {
    border-color: $primary-color;
  }

  .vpdb-FeaturedToolsListItem {
    &__selected {
      .vpdb-FeaturedToolsListItemIconContainer {
        border-color: $primary-color;
      }
    }

    &__selected:active, &__selected:hover, &__selected:link, &__selected:visited {
      border-color: $primary-color;
    }
  }

}


body.vpdb-Body {
  background-image: unset;
  font-family: Roboto, "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;

  h1, h2, h3, h4, h5, h6 {
    font-family: Roboto, "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  }

  // FIXME: Find sensible values for these
  min-width: unset;
  width: unset;



  .vpdb-RootContainer {

    display: grid;

    // FIXME: Should also provide fallback styling for IE11,
    // as unfortunately, IE11 doesn't support grid-template-areas
    grid-template-areas:
      "header"
      "banner"
      "content"
      "footer";
    
    grid-template-rows: $expanded-header-height auto 1fr auto;
    grid-template-columns: 100%;
  
    min-height: 100vh;

    .vpdb-Header {
      grid-area: header;

      &__expanded {
        position: relative;

        @media screen and (max-width: $cramped-header-width) {
          grid-template-areas:
            "site-branding .         project-branding project-branding "
            "site-branding searchbar .                .                "
            ".             menubar   social           login            ";

          .ebrc-HeaderBrandingContainer {
            align-self: flex-start;
            margin-top: 0.5em;
          }
        }
      }

      &__collapsed {
        display: grid;
        position: fixed;
        height: auto;
        padding: 0.5em 0.75em;
        grid-template-areas:
          "site-branding searchbar social login"
          "site-branding menubar social login";

        box-shadow: 0 2px 4px #00000066;

        .ebrc-HeaderSearchBar {
          input, form {
            line-height: normal;
          }

          button {
            line-height: normal;
            padding: 2px 6px;
          }
        }

        .ebrc-HeaderBrandingContainer {
          align-self: center;
        }

        .ebrc-HeaderProjectBranding {
          display: none;
        }
  
        .UserMenu {
          align-self: flex-end;
        }

        .ebrc-HeaderMenuBar > .ebrc-HeaderMenuItemGroup > .ebrc-HeaderMenuItemContent {
          row-gap: 0.5em;
          padding: 0 0.5em;

          @media screen and (max-width: $hamburger-width) {
            padding: 0.5em;
          }
        }
      }

      .vpdb-CommunitySocialMediaLink {
        display: grid;
        grid-template-columns: auto 1fr;
        grid-gap: 0.25em;
      }

      .wdk-CategoriesCheckboxTreeWrapper {
        position: relative;
        
        .wdk-CheckboxTreeItem__leaf {
          .wdk-CheckboxTreeNodeContent { 
            a {
              color: #069;
            }
      
            i {
              margin-right: 0.25em;
            }
          }
        }
      }

      .wdk-CheckboxTree {
        min-width: 18.75em;
      }

      .wdk-CheckboxTreeLinks {
        margin-left: 0;
      }

      .wdk-RealTimeSearchBox {
        &Input {
          border-radius: 0.5em;
          padding: 0.2em 1.5em 0.2em 1.75em;
        }

        &SearchIcon {
          left: 0.5em;
        }
      }

      @media screen and (max-width: $hamburger-width) {
        position: relative;

        grid-template-areas:
          "site-branding site-branding     social    login"
          "hamburger     searchbar         searchbar searchbar"
          "menubar       menubar           menubar   menubar";

        grid-template-columns: auto auto 1fr;

        row-gap: 0.5em;
        padding: 0.5em;
      }

      @media screen and (max-width: $small-mobile-width) {
        .ebrc-SocialMediaLinks {
          a:not(.ebrc-SocialMediaLinks--AnnouncementsToggle) {
            display: none;
          }
        }
      }
    }

    .wdk-Showcase {
      margin: 0
    }
    .News-Section .News .NewsList {
      max-height: 145px;
      border-color: rgba(15,70,100,.12);
      border-style: solid;
      border-width: 1px 0;
    }
    .News-Section .News .NewsList .NewsTeaser{
      display: none;
    }
    .News-Section .AllNewsLink {
      font-size: 110%;
    }

    .vpdb-Announcements {
      grid-area: banner;
    }

    .vpdb-SearchPane {
      grid-area: nav;

      border-right: 0.0625rem solid;
      padding-right: 0.1em;

      .wdk-CheckboxTree {
        > .wdk-CheckboxTreeList {
          position: relative;
          max-height: 65vh;
          overflow-y: auto;
          padding-right: 0.5em;
        }
      }
      
      .wdk-RealTimeSearchBox__withHelp {
        margin-left: 0;
        width: calc(100% - 1em);
  
        .wdk-RealTimeSearchBoxInput {
          padding-left: 2.50em;
        }

      }
   
      .wdk-CheckboxTree > .wdk-CheckboxTreeList > .wdk-CheckboxTreeItem > .wdk-CheckboxTreeList {
        padding-left: 0.5em;
      }

      .wdk-CheckboxTreeList .wdk-CheckboxTreeItem__leaf .wdk-CheckboxTreeNodeContent {
        margin-left: 0.2em;
      }

      .wdk-CheckboxTreeList .wdk-CheckboxTreeItem__leaf .wdk-CheckboxTreeNodeContent i {
        font-size: 0.7em;
        color: grey;
      }

      @media screen and (max-width: $mobile-width) {
        border-right: none;
        padding-right: 1rem;

        .wdk-CheckboxTree {
          > .wdk-CheckboxTreeList {
            max-height: none;
            padding-right: 1rem;
          }
        }
      }
    }

    .vpdb-Main {
      grid-area: content;

      margin: 1rem 0;
      padding: 0 1rem 0 1.25rem;
      position: relative;

      > hr {
        margin: 1.5rem 0 0.5rem 0;
      }
    }

    .vpdb-NewsPane {
      grid-area: side;

      border-left: 0.0625rem solid;

      &__news-collapsed {
        border-left-style: hidden;
      }

      .wdk-Showcase-HeadingRow {
        display: none;
      }

      @media screen and (max-width: $tablet-width) {
        border-left: none;

        .wdk-Showcase-HeadingRow {
          display: flex;
        }
      }
    }

    .vpdb-Footer {
      grid-area: footer;
    }

    @media screen and (max-width: $mobile-width) {
      &__home {
        display: flex;
        flex-direction: column;
      }
    }

    // /***** PORTAL *******/
    // &.VEuPathDB, &.EuPathDB {
    //   .vpdb-Header {
    //     background-image: url('~site/images/VEuPathDB/header-veupathDB.jpg');
    //     background-size: cover;
    //     background-position: center;

    //     .ebrc-HeaderBranding {
    //       position: relative;
    //       bottom: 20px;
    //       height: calc(72px * 1.2);
    //       content: url('~site/images/VEuPathDB/logos/VEuPathDB.png');
    //     }

    //     &__collapsed {
    //       .ebrc-HeaderBranding {
    //         bottom: 0px;
    //         height: calc(48px * 1.15);
    //         content: url('~site/images/VEuPathDB/veupath-logo-no-tag.png');
    //       }
    //     }
    //   }
    // }

    &__home {
      // FIXME: Should also provide fallback styling for IE11,
      // as unfortunately, IE11 doesn't support grid-template-areas
      grid-template-areas:
        "header header header"
        "banner banner banner"
        "nav content side"
        "footer footer footer";

      .vpdb-Main {
        overflow: hidden;
      }

      @media screen and (max-width: $hamburger-width) {
        grid-template-rows: auto auto 1fr auto;
      }

      @media screen and (max-width: $tablet-width) {
        grid-template-areas:
          "header header header"
          "banner banner banner"
          "nav content content"
          "nav content content"
          "nav side side"
          "footer footer footer"
      }
    }

    &__home.vpdb-RootContainer__news-expanded {
      grid-template-columns: 26em 1fr 23em;
    }

    &__home.vpdb-RootContainer__news-collapsed {
      grid-template-columns: 31em 1fr 3em;
    }

    @media screen and (max-width: $mobile-width) {
      // FIXME: Should also provide fallback styling for IE11,
      // as unfortunately, IE11 doesn't support grid-template-areas
      grid-template-areas:
        "header"
        "banner"
        "nav"
        "content"
        "side"
        "footer";

      grid-template-rows: auto auto auto 1fr auto auto;

      &__home.vpdb-RootContainer__news-expanded, &__home.vpdb-RootContainer__news-collapsed {
        grid-template-columns: 100%;
      }
    }
  }

  .vpdb-BgDark {
    background-color: #02385a;
  }

  .vpdb-BdDark {
    border-color: #02385a; 
  }

  .vpdb-BgWash {
    background-color: #eef0f2;
  }

  // Fix for question page sticky header
  .wdk-QuestionFormQuestionHeader {
    top: $collapsed-header-height;

    @media screen and (max-width: $hamburger-width) {
      top: 0;
    }
  }
}
